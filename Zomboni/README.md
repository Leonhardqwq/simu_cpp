# 使用说明

## 使用方法

在excel中键入场景参数并保存文件，运行read_info.exe文件，待弹窗消失后运行主程序。  
- 仅绿色单元格可编辑参数，红色单元格为提示语或弃用参数
- 主程序运行时，括号内数字代表测试进度，括号后数字代表截至目前测得的破阵率
- 主程序运行结束后，会依次输出：最终破阵率、破阵次数和总测试次数、破阵率的95%置信区间（Wilson CI）

## 更新内容
### 底层优化
- 使用C++重写，利用多线程和O2优化大幅加快测试速度，轻松实现千万次测试。
### 机制判定
修复了诸多不符合原生机制的bug：
- 冰车机制：
  - 血量在临界值以下的自扣血机制完全按照游戏逻辑。原来的扣血机制为每cs有60%概率扣1点，而新版本/游戏原生的扣血机制为每cs有20%概率扣3点。
  - 所有坐标计算使用C++原生flaot数据类型，减少浮点数误差。
  - 修正了盖冰道的判定，复合原生机制，盖n列冰道的临界坐标为$80(n-1)+\Delta$，其中偏移值$\Delta$对2-8列为-11，对1列为-10，对9列为-8。

- 植物机制：
  - 完全复现了植物的触发、攻击机制，特别的，非永动的冰瓜在冰车进入可伤域时触发。
  - 修复了喷、曾向左攻击范围无限的问题。
- 交互机制：
  - 修正了帧内判定顺序问题，严格按照植物，僵尸，子弹顺次进行相关判定。
  - 修正了判定时的结算问题，在本帧未完成坐标更新前使用上一帧坐标，在完成后才使用本帧坐标。


### 参数更新
- `被压类型`参数增加了炮，并且添加了相关判定。
- 新增锁部分随机数功能，测试0破阵率：
  - 新增参数`锁植物反应`，设置`最快`时，锁最短攻击间隔，`最慢`同理。
- 删除了`时间上限`参数，程序自动计算适合的时间上限。
- 删除了`指定溅射时间冰瓜`参数，不再支持相关测试。


## 特殊说明
- 假设冰瓜对冰车始终只有26点溅射伤害，不考虑直伤，也不考虑溅射伤害衰减。
  - 本程序测试结果近似代表*一波*高密度冰车的破阵概率，对比小丑测试程序，其测试结果只代表*一只*小丑的破阵概率，两者输出结果的含义是完全不同的。
  - 冰车可受直伤的非高密度情景完全不适用本程序，且其破阵率也远低于程序给出的结果。
- 假设冰瓜的攻击范围固定，溅射空间的定义和常用值可参考作者b站往期专栏。简单的参考值有，巨人对普通植物举锤溅射空间约为1，也是曾向右受僵尸触发的范围，橄榄对普通植物啃食溅射空间约为0.4，对南瓜需要+0.375，对炮需要-0.125。
- 冰瓜向左攻击范围无限。
- 假设非永动植物在触发激活后始终为永动状态。

---

如有问题请联系开发者：b站 Leonhard_qwq https://space.bilibili.com/171987343